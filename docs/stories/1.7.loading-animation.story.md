# Story 1.7: Loading Animation and Smooth Entry

## Status
Ready for Review

## Story
**As a** visitor,
**I want** to see an engaging loading animation while the portfolio assets load,
**so that** the wait feels intentional and establishes quality expectations.

## Acceptance Criteria

1. `src/components/ui/LoadingScreen.jsx` component created
2. Loading screen displayed immediately when app mounts
3. Loading animation implemented using Framer Motion or GSAP (particle effect, fade-in, or spinner)
4. Loading progress indicator shows percentage or visual progress
5. Loading screen monitors asset loading state (3D models, fonts, etc.) using Suspense or loading events
6. Loading screen minimum display time: 1 second (even if assets load faster, to show animation)
7. Smooth transition from loading screen to 3D scene (fade out loading, fade in 3D)
8. Loading screen styled consistently with overall portfolio aesthetic
9. No "flash of unstyled content" (FOUC) - loading screen appears immediately
10. 3D scene only renders after loading screen completes transition

## Tasks / Subtasks

- [ ] Create LoadingScreen component (AC: 1, 8)
  - [ ] Create file `src/components/ui/LoadingScreen.tsx`
  - [ ] Set up component structure with TypeScript
  - [ ] Style with Tailwind CSS matching portfolio theme
  - [ ] Use full viewport (fixed inset-0) to cover entire screen
  - [ ] Export LoadingScreen component

- [ ] Implement loading animation (AC: 3)
  - [ ] Choose animation type: spinner, fade-in text, or particle effect
  - [ ] Use Framer Motion for animations
  - [ ] Create engaging visual (e.g., animated logo, pulsing text, spinner)
  - [ ] Ensure animation loops smoothly
  - [ ] Keep animation simple for fast initial render

- [ ] Add progress indicator (AC: 4)
  - [ ] Add progress state (0-100%)
  - [ ] Display progress bar or percentage text
  - [ ] Animate progress smoothly
  - [ ] Style progress indicator with theme colors

- [ ] Implement loading state management in App (AC: 2, 5, 6, 9, 10)
  - [ ] Add loading state in App.tsx
  - [ ] Set initial loading state to true
  - [ ] Use useEffect to simulate/monitor asset loading
  - [ ] Implement minimum display time (1 second)
  - [ ] Update progress during loading
  - [ ] Set loading to false after completion

- [ ] Add smooth transition animations (AC: 7, 10)
  - [ ] Use Framer Motion AnimatePresence for loading screen exit
  - [ ] Fade out loading screen (opacity 0)
  - [ ] Delay 3D scene render until loading complete
  - [ ] Fade in 3D scene smoothly
  - [ ] Ensure no flash or jarring transition

- [ ] Integrate LoadingScreen into App (AC: 2, 9)
  - [ ] Render LoadingScreen conditionally based on loading state
  - [ ] Position LoadingScreen above all content (z-index)
  - [ ] Ensure LoadingScreen appears immediately on mount
  - [ ] Render Scene only after loading is false

- [ ] Test loading experience (AC: 3, 4, 6, 7, 9, 10)
  - [ ] Verify loading screen appears immediately
  - [ ] Check animation is engaging and smooth
  - [ ] Test progress indicator updates
  - [ ] Verify minimum 1 second display time
  - [ ] Check smooth transition to 3D scene
  - [ ] Test no FOUC occurs
  - [ ] Verify 3D scene doesn't render during loading

## Dev Notes

### Previous Story Insights
[Source: Stories 1.1 through 1.6 Completion]

**Story 1.1 established:**
- Vite + React + TypeScript project
- Framer Motion installed for animations

**Stories 1.2-1.6 established:**
- Complete 3D scene with project cards
- All interactive features working
- Scene.tsx rendering Canvas

**Key Learnings for Story 1.7:**
- App.tsx or main entry point needs loading state
- Framer Motion available for animations
- Need to delay 3D scene render until loading complete
- LoadingScreen must appear immediately to prevent FOUC

### LoadingScreen Component Structure
[Source: docs/ui-architecture.md#Component Standards]

**File Location:** `src/components/ui/LoadingScreen.tsx`

**Component Template:**
```typescript
// src/components/ui/LoadingScreen.tsx

import React from 'react';
import { motion } from 'framer-motion';

interface LoadingScreenProps {
  progress?: number;  // 0-100
}

export const LoadingScreen: React.FC<LoadingScreenProps> = ({ progress = 0 }) => {
  return (
    <motion.div
      initial={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 0.5 }}
      className="fixed inset-0 z-50 flex flex-col items-center justify-center bg-gray-900"
    >
      {/* Logo or title */}
      <motion.h1
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.6, delay: 0.2 }}
        className="text-4xl font-bold text-white mb-8"
      >
        Omkar Jore
      </motion.h1>

      {/* Animated subtitle */}
      <motion.p
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ duration: 0.6, delay: 0.4 }}
        className="text-xl text-gray-400 mb-12"
      >
        CAD Automation Developer
      </motion.p>

      {/* Loading spinner or animation */}
      <motion.div
        animate={{ rotate: 360 }}
        transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}
        className="w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full"
      />

      {/* Progress bar */}
      <div className="w-64 h-2 bg-gray-800 rounded-full mt-8 overflow-hidden">
        <motion.div
          initial={{ width: 0 }}
          animate={{ width: `${progress}%` }}
          transition={{ duration: 0.3 }}
          className="h-full bg-cyan-500"
        />
      </div>

      {/* Progress percentage */}
      <motion.p
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: 0.6 }}
        className="text-gray-500 mt-4"
      >
        {Math.round(progress)}%
      </motion.p>
    </motion.div>
  );
};
```

### Loading State Management in App
[Source: docs/ui-architecture.md#State Management]

**App.tsx with Loading State:**
```typescript
// src/App.tsx

import React, { useState, useEffect } from 'react';
import { AnimatePresence } from 'framer-motion';
import { LoadingScreen } from './components/ui/LoadingScreen';
import { Scene } from './components/3d/Scene';
import { ProjectModal } from './components/ui/ProjectModal';

export const App: React.FC = () => {
  const [loading, setLoading] = useState(true);
  const [progress, setProgress] = useState(0);

  useEffect(() => {
    // Simulate loading with progress
    const duration = 2000; // 2 seconds total
    const minDuration = 1000; // Minimum 1 second
    const interval = 50; // Update every 50ms
    const steps = duration / interval;
    let currentStep = 0;

    const timer = setInterval(() => {
      currentStep++;
      const newProgress = (currentStep / steps) * 100;
      setProgress(newProgress);

      if (newProgress >= 100) {
        clearInterval(timer);
        // Wait for minimum duration before hiding
        setTimeout(() => {
          setLoading(false);
        }, Math.max(0, minDuration - duration));
      }
    }, interval);

    return () => clearInterval(timer);
  }, []);

  return (
    <div className="relative w-full h-screen overflow-hidden">
      <AnimatePresence>
        {loading && <LoadingScreen progress={progress} />}
      </AnimatePresence>

      {!loading && (
        <>
          <Scene />
          <ProjectModal />
        </>
      )}
    </div>
  );
};

export default App;
```

### Framer Motion AnimatePresence
[Source: docs/ui-architecture.md#Frontend Tech Stack - Framer Motion]

**AnimatePresence for Exit Animations:**
- Wraps components that should animate when removed from React tree
- Enables exit animations defined in motion components
- Only direct children animate on exit

**Usage Pattern:**
```typescript
<AnimatePresence>
  {loading && (
    <motion.div
      initial={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 0.5 }}
    >
      {/* Loading screen content */}
    </motion.div>
  )}
</AnimatePresence>
```

### Minimum Display Time Implementation

**Ensuring 1 Second Minimum:**
```typescript
const MIN_DISPLAY_TIME = 1000; // 1 second
const startTime = Date.now();

// When loading completes
const elapsedTime = Date.now() - startTime;
const remainingTime = Math.max(0, MIN_DISPLAY_TIME - elapsedTime);

setTimeout(() => {
  setLoading(false);
}, remainingTime);
```

**Alternative (Simpler for MVP):**
```typescript
// Fixed 2 second loading time (meets 1 second minimum)
useEffect(() => {
  const timer = setTimeout(() => {
    setLoading(false);
  }, 2000);

  return () => clearTimeout(timer);
}, []);
```

### Loading Animation Options

**Option 1: Spinning Circle (Recommended for MVP):**
```typescript
<motion.div
  animate={{ rotate: 360 }}
  transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}
  className="w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full"
/>
```

**Option 2: Pulsing Logo/Text:**
```typescript
<motion.div
  animate={{ scale: [1, 1.1, 1] }}
  transition={{ duration: 2, repeat: Infinity }}
  className="text-4xl font-bold text-cyan-500"
>
  OJ
</motion.div>
```

**Option 3: Particle Effect with Framer Motion:**
```typescript
// Multiple animated dots
{[...Array(5)].map((_, i) => (
  <motion.div
    key={i}
    animate={{ y: [0, -20, 0] }}
    transition={{
      duration: 1,
      repeat: Infinity,
      delay: i * 0.1,
    }}
    className="w-3 h-3 bg-cyan-500 rounded-full mx-1"
  />
))}
```

### Progress Indicator Patterns

**Progress Bar:**
```typescript
<div className="w-64 h-2 bg-gray-800 rounded-full overflow-hidden">
  <motion.div
    animate={{ width: `${progress}%` }}
    transition={{ duration: 0.3 }}
    className="h-full bg-cyan-500"
  />
</div>
```

**Percentage Text:**
```typescript
<p className="text-gray-400 text-lg">
  {Math.round(progress)}%
</p>
```

**Spinner Only (No Progress):**
```typescript
// Just show spinner without numerical progress
// Simpler but less informative
```

### Preventing FOUC (Flash of Unstyled Content)
[Source: AC 9]

**FOUC Prevention Strategies:**
1. Set loading state to true initially (before any render)
2. Render LoadingScreen immediately on mount
3. Use fixed positioning with high z-index
4. Don't conditionally import Scene (always import, conditionally render)

**Correct Pattern:**
```typescript
// Initial state is true - loading screen shows immediately
const [loading, setLoading] = useState(true);

// LoadingScreen renders first, Scene waits
{loading && <LoadingScreen />}
{!loading && <Scene />}
```

**Incorrect Pattern (causes FOUC):**
```typescript
// Don't do this - Scene might render briefly
const [loading, setLoading] = useState(false);
```

### Conditional Rendering vs Mounting

**Delay Scene Render (AC 10):**
```typescript
// Good: Scene only mounts after loading
{!loading && <Scene />}

// Bad: Scene mounts but is hidden (still loads assets)
<div className={loading ? 'hidden' : 'block'}>
  <Scene />
</div>
```

### Theme Consistency
[Source: docs/ui-architecture.md#Tailwind Configuration]

**Loading Screen Colors:**
- Background: `bg-gray-900` (dark background)
- Text: `text-white` (title), `text-gray-400` (subtitle)
- Accent: `text-cyan-500` or `border-cyan-500` (spinner, progress)
- Progress bar: `bg-gray-800` (background), `bg-cyan-500` (fill)

### Performance Considerations
[Source: docs/prd.md#Non-Functional Requirements]

**NFR3:** Initial page load <3 seconds on desktop

**Loading Screen Performance:**
- LoadingScreen itself must be lightweight
- Simple animations only (no heavy libraries)
- Framer Motion already loaded (no additional bundle)
- Avoid loading large assets in LoadingScreen
- Use CSS/Tailwind styling (fast)

### Testing
**Testing Standards:**
[Source: docs/ui-architecture.md#Testing Requirements]

- Manual testing only for MVP
- Verify loading screen appears immediately
- Check animation is smooth and engaging
- Test minimum 1 second display time
- Verify smooth transition to 3D scene
- Check no FOUC
- Test 3D scene doesn't render during loading
- No automated tests required

**Key Test Points:**
1. Loading screen appears immediately on page load
2. No flash of 3D scene before loading screen
3. Animation is smooth and loops correctly
4. Progress bar/percentage updates smoothly
5. Loading screen displays for at least 1 second
6. Smooth fade out transition
7. 3D scene fades in smoothly after loading
8. No jarring transition or visual jump
9. Loading screen styled consistently with theme
10. No console errors during loading

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-31 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-10-31 | 1.1 | Story implementation completed | James (Dev Agent) |

---

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
None

### Completion Notes List
- Created LoadingScreen component with Framer Motion animations
- Implemented full viewport overlay (fixed inset-0, z-50)
- Added animated title "Omkar Jore" with fade-in and slide-up effect
- Added subtitle "CAD Automation Developer" with delayed fade-in
- Implemented spinning loader (cyan border, rotating 360deg continuously)
- Added progress bar with smooth width animation (cyan fill)
- Added progress percentage display (0-100%)
- Updated App.tsx with loading state management (useState)
- Implemented progress simulation (2 second duration, updates every 50ms)
- Added AnimatePresence for smooth exit transitions
- Scene and ProjectModal only render after loading completes (!loading)
- Loading screen fades out smoothly (opacity 0, duration 0.5s)
- Minimum display time enforced (2.2 seconds total)
- Prevents FOUC by setting initial loading state to true
- Styled with dark theme (bg-gray-900) and cyan accents
- Dev server running successfully with HMR
- Production build successful in 5.78s with no errors
- Linting passes with no errors
- Smooth transition from loading screen to 3D scene

### File List
**Created:**
- `src/components/ui/LoadingScreen.tsx` - Loading screen component with animations

**Modified:**
- `src/App.tsx` - Added loading state management and AnimatePresence

---

## QA Results
_To be filled by QA Agent_
