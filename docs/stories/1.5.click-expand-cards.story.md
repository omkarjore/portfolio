# Story 1.5: Click Interaction to Expand Project Cards

## Status
Ready for Review

## Story
**As a** visitor,
**I want** to click on a project card to see detailed information,
**so that** I can learn about specific projects without leaving the 3D experience.

## Acceptance Criteria

1. Click events registered on ProjectCard meshes using `onClick` handler
2. Clicking card triggers state change to "expanded" mode
3. Expanded card displays modal/overlay with detailed content:
   - Full project title
   - Project description (2-3 sentences)
   - Technology stack used
   - Key metrics (for Thermax: "40% time reduction, 50+ drawings automated")
   - GitHub repository link (if applicable)
4. Expanded view has close button (X icon) or click-outside-to-close functionality
5. Only one card can be expanded at a time (expanding new card closes previous)
6. Expanded view rendered using HTML overlay (not 3D text for readability)
7. Expanded view styled with Tailwind CSS for consistent design
8. Close interaction returns to 3D gallery view smoothly
9. Expanded view is responsive and readable on desktop viewport
10. Click interaction works on all three project cards

## Tasks / Subtasks

- [x] Create ProjectContext for expanded card state (AC: 2, 5)
  - [x] Create file `src/context/ProjectContext.tsx`
  - [x] Define ProjectState interface with expandedProjectId
  - [x] Create ProjectProvider with useState for expandedProjectId
  - [x] Implement expandProject and closeProject functions
  - [x] Export useProjectContext custom hook
  - [x] Add error handling for hook usage outside provider

- [x] Add ProjectProvider to application (AC: 2)
  - [x] Import ProjectProvider in main.tsx
  - [x] Wrap App with ProjectProvider (alongside AppProvider if present)
  - [x] Verify context is accessible throughout app

- [x] Add onClick handler to ProjectCard (AC: 1, 2)
  - [x] Import useProjectContext in ProjectCard.tsx
  - [x] Add onClick handler to mesh
  - [x] Call expandProject with card's project ID on click
  - [x] Test click interaction on all three cards

- [x] Extend project data with detailed information (AC: 3)
  - [x] Update ProjectData interface in projects.ts
  - [x] Add fields: fullDescription, techStack, metrics, githubUrl
  - [x] Populate data for all three projects
  - [x] Include Thermax metrics: "40% time reduction, 50+ drawings automated"

- [x] Create ProjectModal component (AC: 3, 4, 6, 7, 9)
  - [x] Create file `src/components/ui/ProjectModal.tsx`
  - [x] Use useProjectContext to get expandedProjectId
  - [x] Find project data by expandedProjectId
  - [x] Render modal overlay when project is expanded
  - [x] Display: title, description, tech stack, metrics, GitHub link
  - [x] Add close button (X icon)
  - [x] Add click-outside-to-close functionality
  - [x] Style with Tailwind CSS (responsive, readable)
  - [x] Position as fixed overlay above 3D canvas

- [x] Implement smooth modal transitions (AC: 8)
  - [x] Add Framer Motion for modal animations
  - [x] Animate modal entry (fade in, scale up)
  - [x] Animate modal exit (fade out, scale down)
  - [x] Ensure smooth transition back to 3D gallery

- [x] Integrate ProjectModal into Scene/App (AC: 6, 10)
  - [x] Import ProjectModal in App.tsx or Scene.tsx
  - [x] Render ProjectModal alongside Canvas
  - [x] Verify modal displays above 3D scene (z-index)
  - [x] Test click interaction on all three cards
  - [x] Verify only one card expanded at a time

- [x] Test expanded view functionality (AC: 3, 4, 5, 8, 9, 10)
  - [x] Click each project card and verify modal opens
  - [x] Verify all content displays correctly
  - [x] Test close button functionality
  - [x] Test click-outside-to-close
  - [x] Verify only one modal open at a time
  - [x] Check smooth transitions
  - [x] Verify responsive layout on desktop viewports

## Dev Notes

### Previous Story Insights
[Source: Stories 1.1, 1.2, 1.3, and 1.4 Completion]

**Story 1.1 established:**
- Vite + React + TypeScript project with all dependencies
- Framer Motion installed for animations

**Story 1.2 established:**
- Scene.tsx with Canvas rendering

**Story 1.3 established:**
- ProjectCard component with position, title, description props
- Three cards at [-3, 0, 0], [0, 0, 0], [3, 0, 0]
- Hover effects working
- Project data in projects.ts

**Story 1.4 established:**
- Scroll-based camera navigation
- Interactive 3D experience

**Key Learnings for Story 1.5:**
- Project cards are clickable 3D meshes
- Need global state for which card is expanded
- Modal must overlay the 3D canvas (HTML, not 3D)
- Project data needs extended fields for detailed content

### State Management with ProjectContext
[Source: docs/ui-architecture.md#State Management]

**ProjectContext Implementation:**
```typescript
// src/context/ProjectContext.tsx

import React, { createContext, useContext, useState, ReactNode } from 'react';

interface ProjectState {
  expandedProjectId: string | null;
}

interface ProjectContextValue extends ProjectState {
  setExpandedProjectId: (id: string | null) => void;
  expandProject: (id: string) => void;
  closeProject: () => void;
}

const ProjectContext = createContext<ProjectContextValue | undefined>(undefined);

interface ProjectProviderProps {
  children: ReactNode;
}

export const ProjectProvider: React.FC<ProjectProviderProps> = ({ children }) => {
  const [expandedProjectId, setExpandedProjectId] = useState<string | null>(null);

  const expandProject = (id: string) => setExpandedProjectId(id);
  const closeProject = () => setExpandedProjectId(null);

  const value: ProjectContextValue = {
    expandedProjectId,
    setExpandedProjectId,
    expandProject,
    closeProject,
  };

  return <ProjectContext.Provider value={value}>{children}</ProjectContext.Provider>;
};

export const useProjectContext = (): ProjectContextValue => {
  const context = useContext(ProjectContext);
  if (!context) {
    throw new Error('useProjectContext must be used within ProjectProvider');
  }
  return context;
};
```

**Setup in main.tsx:**
```typescript
import { ProjectProvider } from './context/ProjectContext';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <ProjectProvider>
      <App />
    </ProjectProvider>
  </React.StrictMode>
);
```

### Extended Project Data Structure
[Source: Story 1.3 - Project Data + AC 3]

**Updated ProjectData Interface:**
```typescript
// src/data/projects.ts

export interface ProjectData {
  id: string;
  title: string;
  description: string;  // Short description for card
  position: [number, number, number];
  fullDescription: string;  // 2-3 sentences for modal
  techStack: string[];      // Array of technologies
  metrics?: string;         // Optional metrics (for Thermax)
  githubUrl?: string;       // Optional GitHub link
}

export const projects: ProjectData[] = [
  {
    id: 'thermax',
    title: 'Thermax SmartPID',
    description: 'Automated P&ID generation',
    position: [-3, 0, 0],
    fullDescription: 'Automated P&ID (Piping and Instrumentation Diagram) generation system for major industrial clients. Reduced manual drafting time by 40% and automated over 50 technical drawings for THERMAX, L&T, and PRAJ projects.',
    techStack: ['C# .NET 8', 'Autodesk API', 'AI Integration', 'AutoCAD'],
    metrics: '40% time reduction, 50+ drawings automated',
    githubUrl: 'https://github.com/omkarjore/SmartPIDAutomation',
  },
  {
    id: 'navisworks',
    title: 'Navisworks Integration',
    description: 'Custom plugin development',
    position: [0, 0, 0],
    fullDescription: 'Custom Navisworks plugin development for enhanced 3D model coordination and clash detection. Integrated with project workflows to streamline construction documentation and model review processes.',
    techStack: ['C#', 'Navisworks API', '.NET Framework', 'BIM'],
    githubUrl: 'https://github.com/omkarjore/navisworks-integration',
  },
  {
    id: 'console',
    title: 'Console Applications',
    description: 'Automation tools',
    position: [3, 0, 0],
    fullDescription: 'Suite of C# console applications for CAD automation, file processing, and workflow optimization. Built custom tools for batch processing drawings, data extraction, and report generation.',
    techStack: ['C#', '.NET 8', 'File I/O', 'Automation'],
    githubUrl: 'https://github.com/omkarjore/console-apps',
  },
];
```

### Click Handler in ProjectCard
[Source: Story 1.3 - ProjectCard Component]

**Add onClick to ProjectCard:**
```typescript
// src/components/3d/ProjectCard.tsx

import { useProjectContext } from '../context/ProjectContext';

interface ProjectCardProps {
  id: string;  // Add id prop
  position: [number, number, number];
  title: string;
  description: string;
}

export const ProjectCard: React.FC<ProjectCardProps> = ({
  id,
  position,
  title,
  description
}) => {
  const { expandProject } = useProjectContext();
  const meshRef = useRef<THREE.Mesh>(null);
  const [hovered, setHovered] = useState(false);

  // ... existing animation code ...

  return (
    <mesh
      ref={meshRef}
      position={position}
      onPointerEnter={() => setHovered(true)}
      onPointerLeave={() => setHovered(false)}
      onClick={() => expandProject(id)}  // Add click handler
      scale={hovered ? 1.1 : 1}
    >
      {/* ... existing geometry and text ... */}
    </mesh>
  );
};
```

### ProjectModal Component
[Source: docs/ui-architecture.md#Component Standards]

**File Location:** `src/components/ui/ProjectModal.tsx`

**Modal Component Template:**
```typescript
// src/components/ui/ProjectModal.tsx

import React, { useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useProjectContext } from '../../context/ProjectContext';
import { projects } from '../../data/projects';

export const ProjectModal: React.FC = () => {
  const { expandedProjectId, closeProject } = useProjectContext();

  const project = projects.find(p => p.id === expandedProjectId);

  // Close on Escape key
  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') closeProject();
    };
    window.addEventListener('keydown', handleEscape);
    return () => window.removeEventListener('keydown', handleEscape);
  }, [closeProject]);

  if (!project) return null;

  return (
    <AnimatePresence>
      {expandedProjectId && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="fixed inset-0 z-50 flex items-center justify-center bg-black/50"
          onClick={closeProject}  // Click outside to close
        >
          <motion.div
            initial={{ scale: 0.9, opacity: 0 }}
            animate={{ scale: 1, opacity: 1 }}
            exit={{ scale: 0.9, opacity: 0 }}
            className="bg-white rounded-lg shadow-2xl p-8 max-w-2xl w-full mx-4"
            onClick={(e) => e.stopPropagation()}  // Prevent close when clicking modal content
          >
            {/* Close button */}
            <button
              onClick={closeProject}
              className="absolute top-4 right-4 text-gray-500 hover:text-gray-700"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            {/* Project title */}
            <h2 className="text-3xl font-bold mb-4 text-gray-900">{project.title}</h2>

            {/* Description */}
            <p className="text-gray-700 mb-6">{project.fullDescription}</p>

            {/* Tech stack */}
            <div className="mb-6">
              <h3 className="text-lg font-semibold mb-2 text-gray-900">Technologies</h3>
              <div className="flex flex-wrap gap-2">
                {project.techStack.map((tech) => (
                  <span
                    key={tech}
                    className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm"
                  >
                    {tech}
                  </span>
                ))}
              </div>
            </div>

            {/* Metrics (if available) */}
            {project.metrics && (
              <div className="mb-6 p-4 bg-green-50 rounded-lg">
                <h3 className="text-lg font-semibold mb-2 text-green-900">Impact</h3>
                <p className="text-green-700 font-medium">{project.metrics}</p>
              </div>
            )}

            {/* GitHub link */}
            {project.githubUrl && (
              <a
                href={project.githubUrl}
                target="_blank"
                rel="noopener noreferrer"
                className="inline-block px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors"
              >
                View Code on GitHub
              </a>
            )}
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
};
```

### Framer Motion Animations
[Source: docs/ui-architecture.md#Frontend Tech Stack]

**Framer Motion for Modal:**
- `AnimatePresence`: Handles exit animations
- `motion.div`: Animated div element
- `initial`: Starting state (opacity: 0, scale: 0.9)
- `animate`: Ending state (opacity: 1, scale: 1)
- `exit`: Exit state (opacity: 0, scale: 0.9)

**Installation:** Already installed in Story 1.1

### Modal Positioning and z-index
[Source: docs/ui-architecture.md#Styling Guidelines]

**Fixed Overlay:**
- `fixed inset-0`: Covers entire viewport
- `z-50`: High z-index to appear above Canvas
- `flex items-center justify-center`: Centers modal

**Background Overlay:**
- `bg-black/50`: Semi-transparent black background
- Clicking overlay closes modal

### Click-Outside-to-Close Pattern

**Implementation:**
```typescript
// Outer div: onClick closes modal
<div onClick={closeProject}>
  {/* Inner div: stopPropagation prevents close when clicking content */}
  <div onClick={(e) => e.stopPropagation()}>
    {/* Modal content */}
  </div>
</div>
```

### Integration with App
[Source: docs/ui-architecture.md#Routing]

**Add Modal to App.tsx:**
```typescript
// src/App.tsx

import { ProjectModal } from './components/ui/ProjectModal';

<div className="relative w-full h-screen overflow-hidden">
  <Scene />
  <ProjectModal />  {/* Renders above Canvas */}
</div>
```

### Testing
**Testing Standards:**
[Source: docs/ui-architecture.md#Testing Requirements]

- Manual testing only for MVP
- Test click interaction on all cards
- Verify modal content displays correctly
- Test close button and click-outside functionality
- Check only one modal opens at a time
- Verify smooth animations
- Test responsive layout on desktop
- No automated tests required

**Key Test Points:**
1. Click each card opens correct modal
2. All project data displays correctly
3. Close button works
4. Click outside modal closes it
5. Escape key closes modal
6. Only one modal open at a time (expanding new card closes previous)
7. Smooth Framer Motion transitions
8. GitHub links open in new tab
9. Modal is readable and responsive
10. No console errors

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-31 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-10-31 | 1.1 | Story implementation completed | James (Dev Agent) |

---

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
- Fixed TypeScript error: Changed ReactNode import to type-only import using `import type { ReactNode }`
- Fixed ESLint error: Added `/* eslint-disable react-refresh/only-export-components */` to ProjectContext.tsx (standard pattern for context files)

### Completion Notes List
- Created ProjectContext with ProjectProvider and useProjectContext hook for state management
- Added expandedProjectId state to track which card is expanded
- Implemented expandProject and closeProject functions for modal control
- Wrapped App with ProjectProvider in main.tsx
- Extended ProjectData interface with fullDescription, techStack, metrics, githubUrl
- Populated detailed data for all 3 projects (Thermax with metrics "40% time reduction, 50+ drawings automated")
- Added id prop to ProjectCard component
- Imported useProjectContext in ProjectCard and added onClick handler to mesh
- Updated Scene.tsx to pass id prop to ProjectCard instances
- Created ProjectModal component with Framer Motion animations
- Implemented modal overlay with semi-transparent background (bg-black/50)
- Added close button (X icon) with hover effects
- Implemented click-outside-to-close functionality (stopPropagation pattern)
- Added Escape key listener to close modal
- Displayed all project details: title, fullDescription, tech stack badges, metrics, GitHub link
- Styled with Tailwind CSS (responsive, max-w-2xl, rounded corners, shadow)
- Tech stack rendered as blue badges with rounded-full style
- Metrics displayed in green-themed section with border
- GitHub link button with GitHub icon SVG
- Framer Motion animations: fade in/out (opacity), scale 0.9→1→0.9
- AnimatePresence for exit animations
- Integrated ProjectModal into App.tsx alongside Scene
- Dev server running successfully on port 5179 with HMR
- Production build successful in 6.90s (bundle size ~1317 KB including Framer Motion)
- Linting passes with no errors
- All click interactions work on three cards
- Modal displays correctly with smooth transitions

### File List
**Created:**
- `src/context/ProjectContext.tsx` - Project context with state management for expanded cards
- `src/components/ui/ProjectModal.tsx` - Modal component with Framer Motion animations

**Modified:**
- `src/main.tsx` - Added ProjectProvider wrapper
- `src/data/projects.ts` - Extended ProjectData interface and added detailed project information
- `src/components/3d/ProjectCard.tsx` - Added id prop and onClick handler
- `src/components/3d/Scene.tsx` - Passed id prop to ProjectCard components
- `src/App.tsx` - Added ProjectModal component

---

## QA Results
_To be filled by QA Agent_
